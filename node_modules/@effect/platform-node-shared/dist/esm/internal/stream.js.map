{"version":3,"file":"stream.js","names":["SystemError","Cause","Channel","Chunk","Effect","Exit","Fiber","dual","MutableRef","Runtime","Stream","Readable","fromReadable","evaluate","onError","options","fromChannel","fromReadableChannel","toString","readable","maxBytesNumber","maxBytes","Number","undefined","acquireUseRelease","sync","stream","setEncoding","encoding","async","resume","string","bytes","once","err","fail","onFailure","succeed","on","chunk","Buffer","byteLength","Error","closed","destroy","toUint8Array","buffer","alloc","concat","length","fromDuplex","suspend","duplex","void","exit","make","embedInput","unsafeReadableRead","writeInput","cause","set","failCause","pipeThroughDuplex","args","StreamTypeId","self","pipeThroughChannelOrFail","pipeThroughSimple","module","method","reason","writable","endOnDone","onDone","write","writeEffect","close","end","awaitRead","emit","error","zipRight","done","_","iterator","Symbol","next","loop","item","success","value","latch","unsafeMakeLatch","onReadable","unsafeOpen","onErr","current","onEnd","chunkSize","read","fromEffect","unsafeClose","flatMap","await","arr","unsafeFromArray","push","ensuring","off","closeOnDone","StreamAdapter","readLatch","fiber","constructor","runtime","runFork","whenOpen","runForEachChunk","addObserver","isSuccess","squash","_read","_size","_destroy","callback","interrupt","_tag","toReadable","map","toReadableNever","defaultRuntime"],"sources":["../../../src/internal/stream.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}