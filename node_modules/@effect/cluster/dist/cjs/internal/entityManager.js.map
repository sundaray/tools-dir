{"version":3,"file":"entityManager.js","names":["_RpcMessage","require","RpcServer","_interopRequireWildcard","Arr","Cause","Context","Duration","Effect","Equal","Exit","FiberRef","_Function","HashMap","Metric","Option","Schedule","Schema","Scope","_ClusterError","ClusterMetrics","_ClusterSchema","_Entity","Envelope","Message","MessageStorage","Reply","_ShardingConfig","Snowflake","_entityReaper","_interruptors","_resourceMap","_resourceRef","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","make","exports","fnUntraced","entity","buildHandlers","options","config","ShardingConfig","snowflakeGen","Generator","managerScope","scope","storageEnabled","storage","noop","mailboxCapacity","entityMailboxCapacity","clock","context","retryDriver","driver","defectRetryPolicy","andThen","defaultRetryPolicy","activeServers","Map","entities","ResourceMap","address","sharding","isShutdown","EntityNotAssignedToRunner","endLatch","makeLatch","addFinalizer","ignore","resetAddress","activeRequests","defectRequestIds","writeRef","ResourceRef","from","isShuttingDown","handlers","protocol","toHandlersContext","pipe","provide","add","CurrentAddress","CurrentRunnerAddress","runnerAddress","locally","currentLogAnnotations","empty","server","makeNoSerialization","spanPrefix","type","entityId","spanAttributes","concurrency","disableFatalDefects","onFromServer","response","_tag","request","requestId","void","sentReply","rpc","annotations","Persisted","isInterrupted","exit","Uninterruptible","retryRespond","suspend","message","respond","WithExit","id","unsafeNext","flatMap","delete","size","state","lastActiveCheck","unsafeCurrentTimeMillis","orDie","sequence","reply","Chunk","values","lastSentChunk","some","forkIn","onDefect","die","defect","open","extend","sync","write","envelope","RequestId","tag","payload","Request","cause","effect","unsafeRebuild","Array","keys","logError","next","annotateLogs","module","runner","catchAllCause","clientId","current","await","value","withFiberRuntime","fiber","internalInterruptors","interruptible","timeoutOption","entityTerminationTimeout","reaper","EntityReaper","maxIdleTime","toMillis","entityMaxIdleTime","Number","isFinite","register","servers","gauge","tagged","unsafeUpdate","BigInt","sleep","forever","sendLocal","entry","fail","AlreadyProcessingMessage","envelopeId","requests","dieMessage","MailboxFull","lastSentReply","match","onNone","onSome","isSome","replyId","interruptors","interruptShard","shardId","loop","toInterrupt","Set","symbol","forEach","removeIgnore","discard","decodeMessage","decode","makeMessageSchema","identity","isProcessingFor","undefined","excludeReplies","send","matchEffect","onFailure","MalformedMessage","ReplyWithContext","onSuccess","decoded","IncomingEnvelope","IncomingRequestLocal","activeEntityCount","exponential","union","spaced","push","TaggedStruct","transform","Struct","PartialEncodedRequestFromSelf","fields","Literal","payloadSchema","RequestFromSelf","encoded","makeRequest","encode","OptionFromSelf","Union","typeSchema","AckChunk","Interrupt","times","catchAll","delay"],"sources":["../../../src/internal/entityManager.ts"],"sourcesContent":[null],"mappings":";;;;;;AACA,IAAAA,WAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAC,uBAAA,CAAAF,OAAA;AACA,IAAAG,GAAA,GAAAD,uBAAA,CAAAF,OAAA;AACA,IAAAI,KAAA,GAAAF,uBAAA,CAAAF,OAAA;AACA,IAAAK,OAAA,GAAAH,uBAAA,CAAAF,OAAA;AACA,IAAAM,QAAA,GAAAJ,uBAAA,CAAAF,OAAA;AAEA,IAAAO,MAAA,GAAAL,uBAAA,CAAAF,OAAA;AACA,IAAAQ,KAAA,GAAAN,uBAAA,CAAAF,OAAA;AACA,IAAAS,IAAA,GAAAP,uBAAA,CAAAF,OAAA;AACA,IAAAU,QAAA,GAAAR,uBAAA,CAAAF,OAAA;AACA,IAAAW,SAAA,GAAAX,OAAA;AACA,IAAAY,OAAA,GAAAV,uBAAA,CAAAF,OAAA;AACA,IAAAa,MAAA,GAAAX,uBAAA,CAAAF,OAAA;AACA,IAAAc,MAAA,GAAAZ,uBAAA,CAAAF,OAAA;AACA,IAAAe,QAAA,GAAAb,uBAAA,CAAAF,OAAA;AACA,IAAAgB,MAAA,GAAAd,uBAAA,CAAAF,OAAA;AACA,IAAAiB,KAAA,GAAAf,uBAAA,CAAAF,OAAA;AACA,IAAAkB,aAAA,GAAAlB,OAAA;AACA,IAAAmB,cAAA,GAAAjB,uBAAA,CAAAF,OAAA;AACA,IAAAoB,cAAA,GAAApB,OAAA;AAEA,IAAAqB,OAAA,GAAArB,OAAA;AAGA,IAAAsB,QAAA,GAAApB,uBAAA,CAAAF,OAAA;AACA,IAAAuB,OAAA,GAAArB,uBAAA,CAAAF,OAAA;AACA,IAAAwB,cAAA,GAAAtB,uBAAA,CAAAF,OAAA;AACA,IAAAyB,KAAA,GAAAvB,uBAAA,CAAAF,OAAA;AAIA,IAAA0B,eAAA,GAAA1B,OAAA;AACA,IAAA2B,SAAA,GAAAzB,uBAAA,CAAAF,OAAA;AACA,IAAA4B,aAAA,GAAA5B,OAAA;AACA,IAAA6B,aAAA,GAAA7B,OAAA;AACA,IAAA8B,YAAA,GAAA9B,OAAA;AACA,IAAA+B,YAAA,GAAA/B,OAAA;AAA8C,SAAAE,wBAAA8B,CAAA,EAAAC,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAhC,uBAAA,YAAAA,CAAA8B,CAAA,EAAAC,CAAA,SAAAA,CAAA,IAAAD,CAAA,IAAAA,CAAA,CAAAK,UAAA,SAAAL,CAAA,MAAAM,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,QAAAC,OAAA,EAAAV,CAAA,iBAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,SAAAQ,CAAA,MAAAF,CAAA,GAAAL,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAG,CAAA,CAAAK,GAAA,CAAAX,CAAA,UAAAM,CAAA,CAAAM,GAAA,CAAAZ,CAAA,GAAAM,CAAA,CAAAO,GAAA,CAAAb,CAAA,EAAAQ,CAAA,gBAAAP,CAAA,IAAAD,CAAA,gBAAAC,CAAA,OAAAa,cAAA,CAAAC,IAAA,CAAAf,CAAA,EAAAC,CAAA,OAAAM,CAAA,IAAAD,CAAA,GAAAU,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAlB,CAAA,EAAAC,CAAA,OAAAM,CAAA,CAAAK,GAAA,IAAAL,CAAA,CAAAM,GAAA,IAAAP,CAAA,CAAAE,CAAA,EAAAP,CAAA,EAAAM,CAAA,IAAAC,CAAA,CAAAP,CAAA,IAAAD,CAAA,CAAAC,CAAA,WAAAO,CAAA,KAAAR,CAAA,EAAAC,CAAA;AAoC9C;AACO,MAAMkB,IAAI,GAAAC,OAAA,CAAAD,IAAA,gBAAG5C,MAAM,CAAC8C,UAAU,CAAC,WAMpCC,MAA0B,EAC1BC,aAAiD,EACjDC,OAUC;EAED,MAAMC,MAAM,GAAG,OAAOC,8BAAc;EACpC,MAAMC,YAAY,GAAG,OAAOhC,SAAS,CAACiC,SAAS;EAC/C,MAAMC,YAAY,GAAG,OAAOtD,MAAM,CAACuD,KAAK;EACxC,MAAMC,cAAc,GAAGP,OAAO,CAACQ,OAAO,KAAKxC,cAAc,CAACyC,IAAI;EAC9D,MAAMC,eAAe,GAAGV,OAAO,CAACU,eAAe,IAAIT,MAAM,CAACU,qBAAqB;EAC/E,MAAMC,KAAK,GAAG,OAAO7D,MAAM,CAAC6D,KAAK;EACjC,MAAMC,OAAO,GAAG,OAAO9D,MAAM,CAAC8D,OAAO,EAAiD;EACtF,MAAMC,WAAW,GAAG,OAAOvD,QAAQ,CAACwD,MAAM,CACxCf,OAAO,CAACgB,iBAAiB,GAAGzD,QAAQ,CAAC0D,OAAO,CAACjB,OAAO,CAACgB,iBAAiB,EAAEE,kBAAkB,CAAC,GAAGA,kBAAkB,CACjH;EAED,MAAMC,aAAa,GAAG,IAAIC,GAAG,EAAyB;EAEtD,MAAMC,QAAQ,GAIV,OAAOC,wBAAW,CAAC3B,IAAI,CAAC5C,MAAM,CAAC8C,UAAU,CAAC,WAAU0B,OAAO;IAC7D,IAAI,OAAOvB,OAAO,CAACwB,QAAQ,CAACC,UAAU,EAAE;MACtC,OAAO,OAAO,IAAIC,uCAAyB,CAAC;QAAEH;MAAO,CAAE,CAAC;IAC1D;IAEA,MAAMjB,KAAK,GAAG,OAAOvD,MAAM,CAACuD,KAAK;IACjC,MAAMqB,QAAQ,GAAG,OAAO5E,MAAM,CAAC6E,SAAS,EAAE;IAE1C;IACA,OAAOnE,KAAK,CAACoE,YAAY,CACvBvB,KAAK,EACLvD,MAAM,CAAC+E,MAAM,CAAC9B,OAAO,CAACQ,OAAO,CAACuB,YAAY,CAACR,OAAO,CAAC,CAAC,CACrD;IAED,MAAMS,cAAc,GAAkC,IAAIZ,GAAG,EAAE;IAC/D,IAAIa,gBAAgB,GAAkB,EAAE;IAExC;IACA;IACA,MAAMC,QAAQ,GAAG,OAAOC,wBAAW,CAACC,IAAI,CACtC9B,KAAK,EACLvD,MAAM,CAAC8C,UAAU,CAAC,WAAUS,KAAK;MAC/B,IAAI+B,cAAc,GAAG,KAAK;MAE1B;MACA,MAAMC,QAAQ,GAAG,OAAQxC,MAAM,CAACyC,QAAQ,CAACC,iBAAiB,CAACzC,aAAa,CAAC,CAAC0C,IAAI,CAC5E1F,MAAM,CAAC2F,OAAO,CAAC7B,OAAO,CAAC4B,IAAI,CACzB5F,OAAO,CAAC8F,GAAG,CAACC,sBAAc,EAAErB,OAAO,CAAC,EACpC1E,OAAO,CAAC8F,GAAG,CAACE,4BAAoB,EAAE7C,OAAO,CAAC8C,aAAa,CAAC,EACxDjG,OAAO,CAAC8F,GAAG,CAAClF,KAAK,CAACA,KAAK,EAAE6C,KAAK,CAAC,CAChC,CAAC,EACFvD,MAAM,CAACgG,OAAO,CAAC7F,QAAQ,CAAC8F,qBAAqB,EAAE5F,OAAO,CAAC6F,KAAK,EAAE,CAAC,CACR;MAEzD,MAAMC,MAAM,GAAG,OAAOzG,SAAS,CAAC0G,mBAAmB,CAACrD,MAAM,CAACyC,QAAQ,EAAE;QACnEa,UAAU,EAAE,GAAGtD,MAAM,CAACuD,IAAI,IAAI9B,OAAO,CAAC+B,QAAQ,GAAG;QACjDC,cAAc,EAAE;UACd,GAAGvD,OAAO,CAACuD,cAAc;UACzB,aAAa,EAAEzD,MAAM,CAACuD,IAAI;UAC1B,WAAW,EAAE9B,OAAO,CAAC+B;SACtB;QACDE,WAAW,EAAExD,OAAO,CAACwD,WAAW,IAAI,CAAC;QACrCC,mBAAmB,EAAEzD,OAAO,CAACyD,mBAAmB;QAChDC,YAAYA,CAACC,QAAQ;UACnB,QAAQA,QAAQ,CAACC,IAAI;YACnB,KAAK,MAAM;cAAE;gBACX,MAAMC,OAAO,GAAG7B,cAAc,CAAC5C,GAAG,CAACuE,QAAQ,CAACG,SAAS,CAAC;gBACtD,IAAI,CAACD,OAAO,EAAE,OAAO9G,MAAM,CAACgH,IAAI;gBAEhCF,OAAO,CAACG,SAAS,GAAG,IAAI;gBAExB;gBACA;gBACA;gBACA;gBACA,IACEzD,cAAc,IACd1D,OAAO,CAACuC,GAAG,CAACyE,OAAO,CAACI,GAAG,CAACC,WAAW,EAAEC,wBAAS,CAAC,IAC/ClH,IAAI,CAACmH,aAAa,CAACT,QAAQ,CAACU,IAAI,CAAC,KAChChC,cAAc,IAAIxF,OAAO,CAACuC,GAAG,CAACyE,OAAO,CAACI,GAAG,CAACC,WAAW,EAAEI,8BAAe,CAAC,CAAC,EACzE;kBACA,OAAOvH,MAAM,CAACgH,IAAI;gBACpB;gBACA,OAAOQ,YAAY,CACjB,CAAC,EACDxH,MAAM,CAACyH,OAAO,CAAC,MACbX,OAAO,CAACY,OAAO,CAACC,OAAO,CACrB,IAAIzG,KAAK,CAAC0G,QAAQ,CAAC;kBACjBb,SAAS,EAAE3F,SAAS,CAACA,SAAS,CAACwF,QAAQ,CAACG,SAAS,CAAC;kBAClDc,EAAE,EAAEzE,YAAY,CAAC0E,UAAU,EAAE;kBAC7BR,IAAI,EAAEV,QAAQ,CAACU;iBAChB,CAAC,CACH,CACF,CACF,CAAC5B,IAAI,CACJ1F,MAAM,CAAC+H,OAAO,CAAC,MAAK;kBAClB9C,cAAc,CAAC+C,MAAM,CAACpB,QAAQ,CAACG,SAAS,CAAC;kBAEzC;kBACA;kBACA,IAAI9B,cAAc,CAACgD,IAAI,KAAK,CAAC,EAAE;oBAC7BC,KAAK,CAACC,eAAe,GAAGtE,KAAK,CAACuE,uBAAuB,EAAE;kBACzD;kBAEA,OAAOpI,MAAM,CAACgH,IAAI;gBACpB,CAAC,CAAC,EACFhH,MAAM,CAACqI,KAAK,CACb;cACH;YACA,KAAK,OAAO;cAAE;gBACZ,MAAMvB,OAAO,GAAG7B,cAAc,CAAC5C,GAAG,CAACuE,QAAQ,CAACG,SAAS,CAAC;gBACtD,IAAI,CAACD,OAAO,EAAE,OAAO9G,MAAM,CAACgH,IAAI;gBAChC,MAAMsB,QAAQ,GAAGxB,OAAO,CAACwB,QAAQ;gBACjCxB,OAAO,CAACwB,QAAQ,EAAE;gBAClB,IAAI,CAACxB,OAAO,CAACG,SAAS,EAAE;kBACtBH,OAAO,CAACG,SAAS,GAAG,IAAI;gBAC1B;gBACA,OAAOjH,MAAM,CAACqI,KAAK,CAACb,YAAY,CAC9B,CAAC,EACDxH,MAAM,CAACyH,OAAO,CAAC,MAAK;kBAClB,MAAMc,KAAK,GAAG,IAAIrH,KAAK,CAACsH,KAAK,CAAC;oBAC5BzB,SAAS,EAAE3F,SAAS,CAACA,SAAS,CAACwF,QAAQ,CAACG,SAAS,CAAC;oBAClDc,EAAE,EAAEzE,YAAY,CAAC0E,UAAU,EAAE;oBAC7BQ,QAAQ;oBACRG,MAAM,EAAE7B,QAAQ,CAAC6B;mBAClB,CAAC;kBACF3B,OAAO,CAAC4B,aAAa,GAAGnI,MAAM,CAACoI,IAAI,CAACJ,KAAK,CAAC;kBAC1C,OAAOzB,OAAO,CAACY,OAAO,CAACC,OAAO,CAACY,KAAK,CAAC;gBACvC,CAAC,CAAC,CACH,CAAC;cACJ;YACA,KAAK,QAAQ;cAAE;gBACb,OAAOvI,MAAM,CAAC4I,MAAM,CAACC,QAAQ,CAAChJ,KAAK,CAACiJ,GAAG,CAAClC,QAAQ,CAACmC,MAAM,CAAC,CAAC,EAAEzF,YAAY,CAAC;cAC1E;YACA,KAAK,WAAW;cAAE;gBAChB,OAAOsB,QAAQ,CAACoE,IAAI;cACtB;UACF;QACF;OACD,CAAC,CAACtD,IAAI,CACLhF,KAAK,CAACuI,MAAM,CAAC1F,KAAK,CAAC,EACnBvD,MAAM,CAAC2F,OAAO,CAACJ,QAAQ,CAAC,CACzB;MAED,OAAO7E,KAAK,CAACoE,YAAY,CACvBvB,KAAK,EACLvD,MAAM,CAACkJ,IAAI,CAAC,MAAK;QACf5D,cAAc,GAAG,IAAI;MACvB,CAAC,CAAC,CACH;MAED,KAAK,MAAMuC,EAAE,IAAI3C,gBAAgB,EAAE;QACjC,MAAM;UAAEwD,aAAa;UAAEhB;QAAO,CAAE,GAAGzC,cAAc,CAAC5C,GAAG,CAACwF,EAAE,CAAE;QAC1D,OAAO1B,MAAM,CAACgD,KAAK,CAAC,CAAC,EAAE;UACrB,GAAGzB,OAAO,CAAC0B,QAAQ;UACnBvB,EAAE,EAAE,IAAAwB,qBAAS,EAAC3B,OAAO,CAAC0B,QAAQ,CAACrC,SAAS,CAAC;UACzCuC,GAAG,EAAE5B,OAAO,CAAC0B,QAAQ,CAACE,GAAU;UAChCC,OAAO,EAAE,IAAIC,eAAO,CAAC;YACnB,GAAG9B,OAAO,CAAC0B,QAAQ;YACnBV;WACM;SACT,CAAC;MACJ;MACAxD,gBAAgB,GAAG,EAAE;MAErB,OAAOiB,MAAM,CAACgD,KAAK;IACrB,CAAC,CAAC,CACH;IAED,SAASN,QAAQA,CAACY,KAAyB;MACzC,MAAMC,MAAM,GAAGvE,QAAQ,CAACwE,aAAa,EAAE;MACvCzE,gBAAgB,GAAG0E,KAAK,CAACvE,IAAI,CAACJ,cAAc,CAAC4E,IAAI,EAAE,CAAC;MACpD,OAAO7J,MAAM,CAAC8J,QAAQ,CAAC,8BAA8B,EAAEL,KAAK,CAAC,CAAC/D,IAAI,CAChE1F,MAAM,CAACkE,OAAO,CAAClE,MAAM,CAAC+E,MAAM,CAAChB,WAAW,CAACgG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EACvD/J,MAAM,CAACkE,OAAO,CAACwF,MAAM,CAAC,EACtB1J,MAAM,CAACgK,YAAY,CAAC;QAClBC,MAAM,EAAE,eAAe;QACvBzF,OAAO;QACP0F,MAAM,EAAEjH,OAAO,CAAC8C;OACjB,CAAC,EACF/F,MAAM,CAACmK,aAAa,CAACtB,QAAQ,CAAC,CAC/B;IACH;IAEA,MAAMX,KAAK,GAAgB;MACzB1D,OAAO;MACP2E,KAAKA,CAACiB,QAAQ,EAAE1C,OAAO;QACrB,IAAIvC,QAAQ,CAAC+C,KAAK,CAACmC,OAAO,CAACxD,IAAI,KAAK,UAAU,EAAE;UAC9C,OAAO7G,MAAM,CAAC+H,OAAO,CAAC5C,QAAQ,CAACmF,KAAK,EAAGnB,KAAK,IAAKA,KAAK,CAACiB,QAAQ,EAAE1C,OAAO,CAAC,CAAC;QAC5E;QACA,OAAOvC,QAAQ,CAAC+C,KAAK,CAACmC,OAAO,CAACE,KAAK,CAACH,QAAQ,EAAE1C,OAAO,CAAC;MACxD,CAAC;MACDzC,cAAc;MACdkD,eAAe,EAAEtE,KAAK,CAACuE,uBAAuB;KAC/C;IAED;IACA;IACA;IACA;IACA,OAAO1H,KAAK,CAACoE,YAAY,CACvBvB,KAAK,EACLvD,MAAM,CAACwK,gBAAgB,CAAEC,KAAK,IAAI;MAChCrG,aAAa,CAAC4D,MAAM,CAACxD,OAAO,CAAC+B,QAAQ,CAAC;MACtCmE,kCAAoB,CAAC9E,GAAG,CAAC6E,KAAK,CAAC5C,EAAE,EAAE,CAAC;MACpC,OAAOK,KAAK,CAACiB,KAAK,CAAC,CAAC,EAAE;QAAEtC,IAAI,EAAE;MAAK,CAAE,CAAC,CAACnB,IAAI,CACzC1F,MAAM,CAACkE,OAAO,CAAClE,MAAM,CAAC2K,aAAa,CAAC/F,QAAQ,CAAC0F,KAAK,CAAC,CAAC,EACpDtK,MAAM,CAAC4K,aAAa,CAAC1H,MAAM,CAAC2H,wBAAwB,CAAC,CACtD;IACH,CAAC,CAAC,CACH;IACDzG,aAAa,CAAC9B,GAAG,CAACkC,OAAO,CAAC+B,QAAQ,EAAE2B,KAAK,CAAC;IAE1C,OAAOA,KAAK;EACd,CAAC,EAAElI,MAAM,CAACgG,OAAO,CAAC7F,QAAQ,CAAC8F,qBAAqB,EAAE5F,OAAO,CAAC6F,KAAK,EAAE,CAAC,CAAC,CAAC;EAEpE,MAAM4E,MAAM,GAAG,OAAOC,0BAAY;EAClC,MAAMC,WAAW,GAAGjL,QAAQ,CAACkL,QAAQ,CAAChI,OAAO,CAAC+H,WAAW,IAAI9H,MAAM,CAACgI,iBAAiB,CAAC;EACtF,IAAIC,MAAM,CAACC,QAAQ,CAACJ,WAAW,CAAC,EAAE;IAChC,OAAOF,MAAM,CAACO,QAAQ,CAAC;MACrBL,WAAW;MACXM,OAAO,EAAElH,aAAa;MACtBE;KACD,CAAC;EACJ;EAEA;EACA,MAAMiH,KAAK,GAAG3K,cAAc,CAAC0D,QAAQ,CAACoB,IAAI,CAACpF,MAAM,CAACkL,MAAM,CAAC,MAAM,EAAEzI,MAAM,CAACuD,IAAI,CAAC,CAAC;EAC9E,OAAOtG,MAAM,CAACkJ,IAAI,CAAC,MAAK;IACtBqC,KAAK,CAACE,YAAY,CAACC,MAAM,CAACtH,aAAa,CAAC6D,IAAI,CAAC,EAAE,EAAE,CAAC;EACpD,CAAC,CAAC,CAACvC,IAAI,CACL1F,MAAM,CAACkE,OAAO,CAAClE,MAAM,CAAC2L,KAAK,CAAC,IAAI,CAAC,CAAC,EAClC3L,MAAM,CAAC4L,OAAO,EACd5L,MAAM,CAAC4I,MAAM,CAACtF,YAAY,CAAC,CAC5B;EAED,SAASuI,SAASA,CAChBnE,OAAiC;IAEjC,OAAO1H,MAAM,CAACgG,OAAO,CACnBhG,MAAM,CAAC+H,OAAO,CACZzD,QAAQ,CAACjC,GAAG,CAACqF,OAAO,CAAC0B,QAAQ,CAAC5E,OAAO,CAAC,EACrC2B,MAAM,IAA6F;MAClG,QAAQuB,OAAO,CAACb,IAAI;QAClB,KAAK,sBAAsB;UAAE;YAC3B;YACA;YACA;YACA,IAAIiF,KAAK,GAAG3F,MAAM,CAAClB,cAAc,CAAC5C,GAAG,CAACqF,OAAO,CAAC0B,QAAQ,CAACrC,SAAS,CAAC;YACjE,IAAI+E,KAAK,EAAE;cACT,OAAO9L,MAAM,CAAC+L,IAAI,CAChB,IAAIC,sCAAwB,CAAC;gBAC3BC,UAAU,EAAEvE,OAAO,CAAC0B,QAAQ,CAACrC,SAAS;gBACtCvC,OAAO,EAAEkD,OAAO,CAAC0B,QAAQ,CAAC5E;eAC3B,CAAC,CACH;YACH;YAEA,MAAM0C,GAAG,GAAGnE,MAAM,CAACyC,QAAQ,CAAC0G,QAAQ,CAAC7J,GAAG,CAACqF,OAAO,CAAC0B,QAAQ,CAACE,GAAG,CAA6B;YAC1F,IAAI,CAAC9F,cAAc,IAAI1D,OAAO,CAACuC,GAAG,CAAC6E,GAAG,CAACC,WAAW,EAAEC,wBAAS,CAAC,EAAE;cAC9D,OAAOpH,MAAM,CAACmM,UAAU,CACtB,oFAAoF,CACrF;YACH;YAEA,IAAIxI,eAAe,KAAK,WAAW,IAAIwC,MAAM,CAAClB,cAAc,CAACgD,IAAI,IAAItE,eAAe,EAAE;cACpF,OAAO3D,MAAM,CAAC+L,IAAI,CAAC,IAAIK,yBAAW,CAAC;gBAAE5H,OAAO,EAAEkD,OAAO,CAAC0B,QAAQ,CAAC5E;cAAO,CAAE,CAAC,CAAC;YAC5E;YAEAsH,KAAK,GAAG;cACN5E,GAAG;cACHQ,OAAO;cACPT,SAAS,EAAE,KAAK;cAChByB,aAAa,EAAEhB,OAAO,CAAC2E,aAAoB;cAC3C/D,QAAQ,EAAE/H,MAAM,CAAC+L,KAAK,CAAC5E,OAAO,CAAC2E,aAAa,EAAE;gBAC5CE,MAAM,EAAEA,CAAA,KAAM,CAAC;gBACfC,MAAM,EAAGjE,KAAK,IAAKA,KAAK,CAAC1B,IAAI,KAAK,OAAO,GAAG0B,KAAK,CAACD,QAAQ,GAAG,CAAC,GAAG;eAClE;aACF;YACDnC,MAAM,CAAClB,cAAc,CAAC3C,GAAG,CAACoF,OAAO,CAAC0B,QAAQ,CAACrC,SAAS,EAAE+E,KAAK,CAAC;YAC5D,OAAO3F,MAAM,CAACgD,KAAK,CAAC,CAAC,EAAE;cACrB,GAAGzB,OAAO,CAAC0B,QAAQ;cACnBvB,EAAE,EAAE,IAAAwB,qBAAS,EAAC3B,OAAO,CAAC0B,QAAQ,CAACrC,SAAS,CAAC;cACzCwC,OAAO,EAAE,IAAIC,eAAO,CAAC;gBACnB,GAAG9B,OAAO,CAAC0B,QAAQ;gBACnBV,aAAa,EAAEhB,OAAO,CAAC2E;eACxB;aACF,CAAC;UACJ;QACA,KAAK,kBAAkB;UAAE;YACvB,MAAMP,KAAK,GAAG3F,MAAM,CAAClB,cAAc,CAAC5C,GAAG,CAACqF,OAAO,CAAC0B,QAAQ,CAACrC,SAAS,CAAC;YACnE,IAAI,CAAC+E,KAAK,EAAE;cACV,OAAO9L,MAAM,CAACgH,IAAI;YACpB,CAAC,MAAM,IACLU,OAAO,CAAC0B,QAAQ,CAACvC,IAAI,KAAK,UAAU,IACpCtG,MAAM,CAACkM,MAAM,CAACX,KAAK,CAACpD,aAAa,CAAC,IAClChB,OAAO,CAAC0B,QAAQ,CAACsD,OAAO,KAAKZ,KAAK,CAACpD,aAAa,CAAC6B,KAAK,CAAC1C,EAAE,EACzD;cACA,OAAO7H,MAAM,CAACgH,IAAI;YACpB;YACA,OAAOb,MAAM,CAACgD,KAAK,CACjB,CAAC,EACDzB,OAAO,CAAC0B,QAAQ,CAACvC,IAAI,KAAK,UAAU,GAChC;cAAEA,IAAI,EAAE,KAAK;cAAEE,SAAS,EAAE,IAAAsC,qBAAS,EAAC3B,OAAO,CAAC0B,QAAQ,CAACrC,SAAS;YAAC,CAAE,GACjE;cAAEF,IAAI,EAAE,WAAW;cAAEE,SAAS,EAAE,IAAAsC,qBAAS,EAAC3B,OAAO,CAAC0B,QAAQ,CAACrC,SAAS,CAAC;cAAE4F,YAAY,EAAE;YAAE,CAAE,CAC9F;UACH;MACF;IACF,CAAC,CACF,EACDxM,QAAQ,CAAC8F,qBAAqB,EAC9B5F,OAAO,CAAC6F,KAAK,EAAE,CAChB;EACH;EAEA,MAAM0G,cAAc,GAAIC,OAAgB,IACtC7M,MAAM,CAACyH,OAAO,CAAC,SAASqF,IAAIA,CAAA;IAC1B,MAAMC,WAAW,GAAG,IAAIC,GAAG,EAAe;IAC1C,KAAK,MAAM9E,KAAK,IAAI9D,aAAa,CAACqE,MAAM,EAAE,EAAE;MAC1C,IAAIoE,OAAO,CAAC5M,KAAK,CAACgN,MAAM,CAAC,CAAC/E,KAAK,CAAC1D,OAAO,CAACqI,OAAO,CAAC,EAAE;QAChDE,WAAW,CAACnH,GAAG,CAACsC,KAAK,CAAC;MACxB;IACF;IACA,IAAI6E,WAAW,CAAC9E,IAAI,KAAK,CAAC,EAAE;MAC1B,OAAOjI,MAAM,CAACgH,IAAI;IACpB;IACA,OAAOhH,MAAM,CAAC+H,OAAO,CACnB/H,MAAM,CAACkN,OAAO,CAACH,WAAW,EAAG7E,KAAK,IAAK5D,QAAQ,CAAC6I,YAAY,CAACjF,KAAK,CAAC1D,OAAO,CAAC,EAAE;MAC3EiC,WAAW,EAAE,WAAW;MACxB2G,OAAO,EAAE;KACV,CAAC,EACFN,IAAI,CACL;EACH,CAAC,CAAC;EAEJ,MAAMO,aAAa,GAAG5M,MAAM,CAAC6M,MAAM,CAACC,iBAAiB,CAACxK,MAAM,CAAC,CAAC;EAE9D,OAAO,IAAAyK,kBAAQ,EAAgB;IAC7BZ,cAAc;IACda,eAAeA,CAAC/F,OAAO,EAAEzE,OAAO;MAC9B,MAAMiF,KAAK,GAAG9D,aAAa,CAAC/B,GAAG,CAACqF,OAAO,CAAC0B,QAAQ,CAAC5E,OAAO,CAAC+B,QAAQ,CAAC;MAClE,IAAI,CAAC2B,KAAK,EAAE,OAAO,KAAK;MACxB,MAAMpB,OAAO,GAAGoB,KAAK,CAACjD,cAAc,CAAC5C,GAAG,CAACqF,OAAO,CAAC0B,QAAQ,CAACrC,SAAS,CAAC;MACpE,IAAID,OAAO,KAAK4G,SAAS,EAAE;QACzB,OAAO,KAAK;MACd,CAAC,MAAM,IAAIzK,OAAO,EAAE0K,cAAc,IAAI7G,OAAO,CAACG,SAAS,EAAE;QACvD,OAAO,KAAK;MACd;MACA,OAAO,IAAI;IACb,CAAC;IACD4E,SAAS;IACT+B,IAAI,EAAGlG,OAAO,IACZ2F,aAAa,CAAC3F,OAAO,CAAC,CAAChC,IAAI,CACzB1F,MAAM,CAAC6N,WAAW,CAAC;MACjBC,SAAS,EAAGrE,KAAK,IAAI;QACnB,IAAI/B,OAAO,CAACb,IAAI,KAAK,kBAAkB,EAAE;UACvC,OAAO7G,MAAM,CAAC8I,GAAG,CAAC,IAAIiF,8BAAgB,CAAC;YAAEtE;UAAK,CAAE,CAAC,CAAC;QACpD;QACA,OAAOzJ,MAAM,CAACqI,KAAK,CAACX,OAAO,CAACC,OAAO,CACjC,IAAIzG,KAAK,CAAC8M,gBAAgB,CAAC;UACzBzF,KAAK,EAAE,IAAIrH,KAAK,CAAC0G,QAAQ,CAAC;YACxBC,EAAE,EAAEzE,YAAY,CAAC0E,UAAU,EAAE;YAC7Bf,SAAS,EAAEW,OAAO,CAAC0B,QAAQ,CAACrC,SAAS;YACrCO,IAAI,EAAEpH,IAAI,CAAC4I,GAAG,CAAC,IAAIiF,8BAAgB,CAAC;cAAEtE;YAAK,CAAE,CAAC;WAC/C,CAAC;UACFvC,GAAG,EAAEnE,MAAM,CAACyC,QAAQ,CAAC0G,QAAQ,CAAC7J,GAAG,CAACqF,OAAO,CAAC0B,QAAQ,CAACE,GAAG,CAAE;UACxDxF;SACD,CAAC,CACH,CAAC;MACJ,CAAC;MACDmK,SAAS,EAAGC,OAAO,IAAI;QACrB,IAAIA,OAAO,CAACrH,IAAI,KAAK,kBAAkB,EAAE;UACvC,OAAOgF,SAAS,CACd,IAAI7K,OAAO,CAACmN,gBAAgB,CAACD,OAAO,CAAC,CACtC;QACH;QACA,MAAMpH,OAAO,GAAGY,OAAuC;QACvD,MAAMR,GAAG,GAAGnE,MAAM,CAACyC,QAAQ,CAAC0G,QAAQ,CAAC7J,GAAG,CAAC6L,OAAO,CAAC9E,QAAQ,CAACE,GAAG,CAAE;QAC/D,OAAOuC,SAAS,CACd,IAAI7K,OAAO,CAACoN,oBAAoB,CAAC;UAC/BhF,QAAQ,EAAE8E,OAAO,CAAC9E,QAAQ;UAC1BiD,aAAa,EAAE6B,OAAO,CAAC7B,aAAa;UACpC1E,OAAO,EAAGY,KAAK,IACbzB,OAAO,CAACa,OAAO,CACb,IAAIzG,KAAK,CAAC8M,gBAAgB,CAAC;YACzBzF,KAAK;YACLrB,GAAG;YACHpD;WACD,CAAC;SAEP,CAAC,CACH;MACH;KACD,CAAC,EACF9D,MAAM,CAAC2F,OAAO,CAAC7B,OAAmC,CAAC,CACpD;IACHuK,iBAAiB,EAAErO,MAAM,CAACkJ,IAAI,CAAC,MAAM9E,aAAa,CAAC6D,IAAI;GACxD,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM9D,kBAAkB,gBAAG3D,QAAQ,CAAC8N,WAAW,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC5I,IAAI,cAC5DlF,QAAQ,CAAC+N,KAAK,cAAC/N,QAAQ,CAACgO,MAAM,CAAC,YAAY,CAAC,CAAC,CAC9C;AAED,MAAMjB,iBAAiB,GAA+CxK,MAA0B,IAW5F;EACF,MAAMmJ,QAAQ,GAAGtM,GAAG,CAACsG,KAAK,EAAqB;EAE/C,KAAK,MAAMgB,GAAG,IAAInE,MAAM,CAACyC,QAAQ,CAAC0G,QAAQ,CAACzD,MAAM,EAAE,EAAE;IACnDyD,QAAQ,CAACuC,IAAI,CACXhO,MAAM,CAACiO,YAAY,CAAC,iBAAiB,EAAE;MACrCtF,QAAQ,EAAE3I,MAAM,CAACkO,SAAS,CACxBlO,MAAM,CAACmO,MAAM,CAAC;QACZ,GAAG7N,QAAQ,CAAC8N,6BAA6B,CAACC,MAAM;QAChDxF,GAAG,EAAE7I,MAAM,CAACsO,OAAO,CAAC7H,GAAG,CAACL,IAAI,CAAC;QAC7B0C,OAAO,EAAGrC,GAA+B,CAAC8H;OAC3C,CAAC,EACFjO,QAAQ,CAACkO,eAAe,EACxB;QACE3B,MAAM,EAAG4B,OAAO,IAAKnO,QAAQ,CAACoO,WAAW,CAACD,OAAO,CAAC;QAClDE,MAAM,EAAE5B;OACT,CACF;MACDnB,aAAa,EAAE5L,MAAM,CAAC4O,cAAc,CAACnO,KAAK,CAACA,KAAK,CAACgG,GAAG,CAAC;KACtD,CAAC,CACH;EACH;EAEA,OAAOzG,MAAM,CAAC6O,KAAK,CACjB,GAAGpD,QAAQ,EACXzL,MAAM,CAACiO,YAAY,CAAC,kBAAkB,EAAE;IACtCtF,QAAQ,EAAE3I,MAAM,CAAC6O,KAAK,CACpB7O,MAAM,CAAC8O,UAAU,CAACxO,QAAQ,CAACyO,QAAQ,CAAC,EACpC/O,MAAM,CAAC8O,UAAU,CAACxO,QAAQ,CAAC0O,SAAS,CAAC;GAExC,CAAC,CACI;AACV,CAAC;AAED,MAAMjI,YAAY,GAAGA,CAAUkI,KAAa,EAAEhG,MAA8B,KAC1EgG,KAAK,KAAK,CAAC,GACThG,MAAM,GACN1J,MAAM,CAAC2P,QAAQ,CAACjG,MAAM,EAAE,MAAM1J,MAAM,CAAC4P,KAAK,CAACpI,YAAY,CAACkI,KAAK,GAAG,CAAC,EAAEhG,MAAM,CAAC,EAAE,GAAG,CAAC,CAAC","ignoreList":[]}