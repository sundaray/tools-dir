{"version":3,"file":"shardManager.js","names":["Arr","_interopRequireWildcard","require","Clock","Effect","_Function","MutableHashMap","MutableHashSet","Option","_RunnerHealth","_ShardId","_ShardStorage","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","State","allRunners","runners","shards","shardsPerGroup","fromStorage","fnUntraced","storage","ShardStorage","runnerHealth","RunnerHealth","storedRunners","getRunners","storedAssignments","getAssignments","deadRunners","empty","aliveRunners","forEach","address","runner","map","isAlive","push","concurrency","discard","length","logWarning","assignedShards","invalidAssignments","shard","isSome","value","now","currentTimeMillis","runnerState","Map","withMetadata","RunnerWithMetadata","registeredAt","group","groups","groupMap","shardState","keys","shardId","ShardId","id","constructor","assignments","perRunner","meta","runnerMap","Set","perRunnerMap","address_","filter","addr","getOrUndefined","add","addGroup","shardMap","none","addAssignments","currentAddress","flatten","delete","addRunner","removeRunner","remove","maxVersion","size","version","undefined","some","allRunnersHaveVersion","pipe","max","every","runnerVersions","getOrElse","constFalse","shardStats","unassigned","isNone","toString","count","shardsPerRunner","isEmpty","shardSet","averageShardsPerRunner","runnerCount","shardGroup","allUnassignedShards","unassignedShards","shardIds","exports","decideAssignmentsForShards","state","shardsToRebalance","extraShards","Math","iter","values","next","done","pickNewRunners","maybeMaxVersion","addressAssignments","unassignments","changes","runnerGroup","shardsGroup","candidate","candidateShards","maybeRunnerMeta","runnerMeta","oldRunner","oldShards","modifyAt","match","onNone","onSome","addAllNested","self","key","oset","fromIterable"],"sources":["../../../src/internal/shardManager.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}