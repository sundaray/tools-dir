{"version":3,"file":"Entity.js","names":["RpcClient","_interopRequireWildcard","require","RpcGroup","RpcServer","Arr","Context","Data","Effect","Equal","Exit","_Function","Hash","Layer","Mailbox","Option","Predicate","_Scope","_ClusterSchema","_EntityAddress","_EntityType","Envelope","_hash","_resourceMap","_RunnerAddress","ShardId","_ShardingConfig","Snowflake","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","TypeId","exports","Symbol","for","isEntity","u","hasProperty","Proto","symbol","structure","type","that","annotate","tag","value","fromRpcGroup","protocol","annotateRpcs","annotateContext","context","annotateRpcsContext","getShardId","entityId","map","shardingTag","sharding","getShardGroup","client","pipe","flatMap","makeClient","toLayer","build","options","registerEntity","isEffect","succeed","effectDiscard","of","identity","toLayerMailbox","buildHandlers","gen","behaviour","mailbox","make","handler","envelope","async","resume","unsafeOffer","resumes","handlers","rpc","requests","keys","Map","complete","request","exit","sync","delete","replier","fail","error","failCause","cause","catchAllCause","values","void","interruptible","forkScoped","concurrency","self","create","EntityType","annotations","ShardGroup","CurrentAddress","Tag","CurrentRunnerAddress","Request","Class","lastSentChunkValue","lastSentChunk","chunk","lastNonEmpty","nextSequence","isNone","sequence","GenericTag","makeTestClient","fnUntraced","entity","layer","config","ShardingConfig","makeShardId","Math","abs","hashString","shardsPerGroup","snowflakeGen","makeGenerator","runnerAddress","RunnerAddress","host","port","entityMap","contextWith","toHandlersContext","provide","add","omit","Scope","entityEntry","dieMessage","ResourceMap","address","EntityAddress","entityType","shardId","provideService","server","makeNoSerialization","onFromServer","response","write","supportsAck","generateRequestId","unsafeNext","onFromClient","message","_tag","payload","requestId","id","none"],"sources":["../../src/Entity.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}