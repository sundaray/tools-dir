{"version":3,"file":"shardManager.js","names":["Arr","Clock","Effect","constFalse","MutableHashMap","MutableHashSet","Option","RunnerHealth","ShardId","ShardStorage","State","allRunners","runners","shards","shardsPerGroup","fromStorage","fnUntraced","storage","runnerHealth","storedRunners","getRunners","storedAssignments","getAssignments","deadRunners","empty","aliveRunners","forEach","address","runner","map","isAlive","set","push","concurrency","discard","length","logWarning","assignedShards","invalidAssignments","shard","isSome","has","value","now","currentTimeMillis","runnerState","Map","withMetadata","RunnerWithMetadata","registeredAt","group","groups","groupMap","get","shardState","keys","n","shardId","id","constructor","assignments","perRunner","meta","runnerMap","Set","perRunnerMap","address_","filter","addr","getOrUndefined","add","addGroup","shardMap","none","addAssignments","currentAddress","flatten","delete","addRunner","removeRunner","remove","maxVersion","size","version","undefined","some","allRunnersHaveVersion","pipe","max","every","runnerVersions","getOrElse","shardStats","unassigned","isNone","toString","count","shardsPerRunner","isEmpty","shardSet","averageShardsPerRunner","runnerCount","shardGroup","allUnassignedShards","unassignedShards","shardIds","decideAssignmentsForShards","state","shardsToRebalance","extraShards","Math","iter","values","i","next","done","pickNewRunners","maybeMaxVersion","addressAssignments","unassignments","changes","runnerGroup","shardsGroup","candidate","candidateShards","maybeRunnerMeta","runnerMeta","oldRunner","oldShards","modifyAt","match","onNone","onSome","addAllNested","self","key","oset","fromIterable"],"sources":["../../../src/internal/shardManager.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}